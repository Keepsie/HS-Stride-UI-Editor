<Window x:Class="HS.Stride.UI.Editor.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:views="clr-namespace:HS.Stride.UI.Editor.Views"
        xmlns:controls="clr-namespace:HS.Stride.UI.Editor.Controls"
        xmlns:ComponentModel="clr-namespace:System.ComponentModel;assembly=WindowsBase"
        mc:Ignorable="d"
        Title="HS Stride UI Editor - © 2025 Happenstance Games LLC"
        Height="900"
        Width="1450"
        WindowStartupLocation="CenterScreen"
        Style="{StaticResource ModernWindow}">

    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="../Styles/ModernTheme.xaml"/>
            </ResourceDictionary.MergedDictionaries>

            <!-- Converters -->
            <views:NullToVisibilityConverter x:Key="NullToVisibilityConverter"/>

            <!-- Context Menu for UI Elements -->
            <ContextMenu x:Key="ElementContextMenu">
                <ContextMenu.Template>
                    <ControlTemplate TargetType="ContextMenu">
                        <Border Background="{StaticResource MediumBackgroundBrush}"
                                BorderBrush="{StaticResource BorderBrush}"
                                BorderThickness="1"
                                CornerRadius="8"
                                Padding="4">
                            <Border.Effect>
                                <DropShadowEffect Color="Black" Opacity="0.4" BlurRadius="12" ShadowDepth="4"/>
                            </Border.Effect>
                            <StackPanel IsItemsHost="True"/>
                        </Border>
                    </ControlTemplate>
                </ContextMenu.Template>
                <MenuItem Header="Delete" Click="DeleteElement_Click" InputGestureText="Del"/>
                <MenuItem Header="Duplicate" Click="DuplicateElement_Click" InputGestureText="Ctrl+D"/>
                <Separator Background="{StaticResource BorderBrush}" Margin="4,4"/>
                <MenuItem Header="Create Parent" Click="CreateParent_Click" ToolTip="Wrap selected elements in a new Canvas container"/>
                <Separator Background="{StaticResource BorderBrush}" Margin="4,4"/>
                <MenuItem Header="Bring to Front" Click="BringToFront_Click" />
                <MenuItem Header="Send to Back" Click="SendToBack_Click" />
                <Separator Background="{StaticResource BorderBrush}" Margin="4,4"/>
                <MenuItem Header="Reset Position" Click="ResetPosition_Click" />
                <MenuItem Header="Reset Size" Click="ResetSize_Click" />
            </ContextMenu>

            <!-- UI Library Collection View with Grouping -->
            <CollectionViewSource x:Key="UILibraryGrouped" x:Name="UILibraryGrouped">
                <CollectionViewSource.GroupDescriptions>
                    <PropertyGroupDescription PropertyName="Category" />
                </CollectionViewSource.GroupDescriptions>
                <CollectionViewSource.SortDescriptions>
                    <ComponentModel:SortDescription PropertyName="Category" />
                    <ComponentModel:SortDescription PropertyName="Name" />
                </CollectionViewSource.SortDescriptions>
            </CollectionViewSource>
        </ResourceDictionary>
    </Window.Resources>

    <Grid>
        <DockPanel Background="{StaticResource DarkBackgroundBrush}">
        <!-- Menu Bar -->
        <Grid DockPanel.Dock="Top" Margin="0,10,0,0">
            <Menu Style="{StaticResource ModernMenu}" HorizontalAlignment="Left">
                <MenuItem Header="_File">
                    <MenuItem Header="_Connect to Project..." x:Name="MenuConnectProject" Click="MenuConnectProject_Click"/>
                    <MenuItem Header="Recent Pro_jects" x:Name="MenuRecentProjects">
                        <MenuItem Header="(No recent projects)" IsEnabled="False" x:Name="MenuNoRecentProjects"/>
                    </MenuItem>
                    <MenuItem Header="Recent Pa_ges" x:Name="MenuRecentPages" IsEnabled="False">
                        <MenuItem Header="(No recent pages)" IsEnabled="False" x:Name="MenuNoRecentPages"/>
                    </MenuItem>
                    <Separator/>
                    <MenuItem Header="_New UI Page" x:Name="MenuNewUIPage" Click="MenuNewUIPage_Click" IsEnabled="False"/>
                    <MenuItem Header="_Open..." x:Name="MenuOpen" Click="MenuOpen_Click" IsEnabled="False"/>
                    <MenuItem Header="_Save" x:Name="MenuSave" Click="MenuSave_Click" IsEnabled="False"/>
                    <MenuItem Header="Save _As..." x:Name="MenuSaveAs" Click="MenuSaveAs_Click" IsEnabled="False"/>
                    <MenuItem Header="_Unload Page" x:Name="MenuUnloadPage" Click="MenuUnloadPage_Click" IsEnabled="False"/>
                    <Separator/>
                    <MenuItem Header="_Import">
                        <MenuItem Header="Import _Textures..." x:Name="MenuImportTextures" Click="MenuImportTextures_Click" IsEnabled="False"/>
                        <MenuItem Header="Import _Fonts..." x:Name="MenuImportFonts" Click="MenuImportFonts_Click" IsEnabled="False"/>
                    </MenuItem>
                    <Separator/>
                    <MenuItem Header="E_xit" Click="MenuExit_Click"/>
                </MenuItem>
                <MenuItem Header="_Edit" x:Name="MenuEdit" SubmenuOpened="MenuEdit_SubmenuOpened">
                    <MenuItem Header="_Undo" x:Name="MenuUndo" Click="MenuUndo_Click" InputGestureText="Ctrl+Z"/>
                    <MenuItem Header="_Redo" x:Name="MenuRedo" Click="MenuRedo_Click" InputGestureText="Ctrl+Y"/>
                    <Separator/>
                    <MenuItem Header="Cu_t" x:Name="MenuCut" Click="MenuCut_Click" InputGestureText="Ctrl+X"/>
                    <MenuItem Header="_Copy" x:Name="MenuCopy" Click="MenuCopy_Click" InputGestureText="Ctrl+C"/>
                    <MenuItem Header="_Paste" x:Name="MenuPaste" Click="MenuPaste_Click" InputGestureText="Ctrl+V"/>
                    <MenuItem Header="_Duplicate" x:Name="MenuDuplicate" Click="DuplicateElement_Click" InputGestureText="Ctrl+D"/>
                    <MenuItem Header="De_lete" x:Name="MenuDelete" Click="DeleteElement_Click" InputGestureText="Del"/>
                    <Separator/>
                    <MenuItem Header="Create _Parent" x:Name="MenuCreateParent" Click="CreateParent_Click"/>
                    <Separator/>
                    <MenuItem Header="Bring to _Front" x:Name="MenuBringToFront" Click="BringToFront_Click"/>
                    <MenuItem Header="Send to _Back" x:Name="MenuSendToBack" Click="SendToBack_Click"/>
                </MenuItem>
                <MenuItem Header="_View">
                    <MenuItem Header="Zoom _In" Click="MenuZoomIn_Click"/>
                    <MenuItem Header="Zoom _Out" Click="MenuZoomOut_Click"/>
                    <MenuItem Header="_Reset Zoom" Click="MenuResetZoom_Click"/>
                    <Separator/>
                    <MenuItem Header="_Reference Image">
                        <MenuItem Header="_Load Reference Image..." x:Name="MenuLoadRefImage" Click="MenuLoadRefImage_Click"/>
                        <MenuItem Header="_Clear Reference Image" x:Name="MenuClearRefImage" Click="MenuClearRefImage_Click" IsEnabled="False"/>
                        <Separator/>
                        <MenuItem Header="Opacity">
                            <Grid Width="200" Margin="4">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="40"/>
                                </Grid.ColumnDefinitions>
                                <Slider x:Name="RefImageOpacitySlider"
                                        Minimum="0" Maximum="100" Value="30"
                                        ValueChanged="RefImageOpacitySlider_ValueChanged"
                                        VerticalAlignment="Center"/>
                                <TextBlock Grid.Column="1" x:Name="RefImageOpacityText" Text="30%"
                                           VerticalAlignment="Center" Margin="8,0,0,0"
                                           Foreground="{StaticResource TextPrimaryBrush}"/>
                            </Grid>
                        </MenuItem>
                    </MenuItem>
                </MenuItem>
                <MenuItem Header="_Help">
                    <MenuItem Header="_Keyboard Shortcuts" Click="MenuKeyboardShortcuts_Click"/>
                    <Separator/>
                    <MenuItem Header="_About" Click="MenuAbout_Click"/>
                </MenuItem>
            </Menu>

            <!-- Page Name and Save Button Container -->
            <StackPanel Orientation="Horizontal"
                        HorizontalAlignment="Right"
                        VerticalAlignment="Center"
                        Margin="0,0,18,10">
                <!-- Save Button -->
                <Button x:Name="QuickSaveButton"
                        Content="Save"
                        Style="{StaticResource PrimaryButton}"
                        Padding="12,6"
                        FontSize="12"
                        FontWeight="Medium"
                        ToolTip="Quick Save"
                        Margin="0,0,8,0"
                        Click="QuickSaveButton_Click"
                        IsEnabled="False"/>

                <!-- Page Name Indicator -->
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="8,0,0,0">
                    <TextBlock Text="Page:"
                               FontSize="12"
                               Foreground="{StaticResource TextSecondaryBrush}"
                               Margin="0,0,6,0"/>
                    <TextBlock x:Name="PageNameIndicator"
                               Text="No page loaded"
                               FontSize="12"
                               FontStyle="Italic"
                               Foreground="{StaticResource TextSecondaryBrush}"/>
                    <TextBlock x:Name="SaveStatusIndicator"
                               Text=""
                               FontSize="12"
                               FontWeight="SemiBold"
                               Foreground="#FF22C55E"
                               Margin="8,0,0,0"/>
                </StackPanel>
            </StackPanel>
        </Grid>

        <!-- Main Content Area -->
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="250" MinWidth="200"/>
                <ColumnDefinition Width="4"/>
                <ColumnDefinition Width="*" MinWidth="600"/>
                <ColumnDefinition Width="4"/>
                <ColumnDefinition Width="280" MinWidth="250"/>
            </Grid.ColumnDefinitions>

            <!-- LEFT SIDEBAR: Hierarchy + UI Components -->
            <Border Grid.Column="0"
                    Background="{StaticResource MediumBackgroundBrush}"
                    BorderBrush="{StaticResource BorderBrush}"
                    BorderThickness="0,0,1,0">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*" MinHeight="150"/>
                        <RowDefinition Height="4"/>
                        <RowDefinition Height="*" MinHeight="150"/>
                    </Grid.RowDefinitions>

                    <!-- Hierarchy Section -->
                    <DockPanel Grid.Row="0" Margin="16">
                        <!-- Logo and App Name -->
                        <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" Margin="0,0,0,16">
                            <Image x:Name="AppLogo"
                                   Source="/hs_ui_editor.png"
                                   Width="32"
                                   Height="32"
                                   Stretch="Uniform"
                                   Margin="0,0,12,0"/>
                            <TextBlock Text="HS Stride UI Editor"
                                       FontSize="14"
                                       FontWeight="SemiBold"
                                       Foreground="{StaticResource TextPrimaryBrush}"
                                       VerticalAlignment="Center"/>
                        </StackPanel>

                        <TextBlock DockPanel.Dock="Top"
                                   Text="HIERARCHY"
                                   FontSize="11"
                                   FontWeight="SemiBold"
                                   Foreground="{StaticResource TextSecondaryBrush}"
                                   Margin="0,0,0,12"/>

                        <Grid>
                            <ScrollViewer x:Name="HierarchyScrollViewer" VerticalScrollBarVisibility="Auto">
                                <TreeView x:Name="VisualTreeView"
                                          Background="Transparent"
                                          BorderThickness="0"
                                          Foreground="{StaticResource TextPrimaryBrush}"
                                          AllowDrop="True">
                                <TreeView.Resources>
                                    <Style TargetType="{x:Type TreeViewItem}">
                                        <Setter Property="IsExpanded" Value="True"/>
                                        <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
                                        <Setter Property="Padding" Value="8"/>
                                        <Setter Property="Margin" Value="0,0,0,2"/>
                                    </Style>
                                </TreeView.Resources>
                                <TreeView.ItemTemplate>
                                    <HierarchicalDataTemplate ItemsSource="{Binding Children}">
                                        <!-- Use Border to show selection state from ViewModel.IsSelected -->
                                        <Border x:Name="ItemBorder"
                                                CornerRadius="4"
                                                Padding="4,2"
                                                Margin="-4,-2">
                                            <Border.Style>
                                                <Style TargetType="Border">
                                                    <Setter Property="Background" Value="Transparent"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding IsSelected}" Value="True">
                                                            <Setter Property="Background" Value="#400A84FF"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Border.Style>
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>
                                                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                                                    <!-- Thumbnail preview for image elements -->
                                                    <Border Width="16" Height="16" Margin="0,0,6,0"
                                                            CornerRadius="2"
                                                            Background="#333"
                                                            BorderBrush="#555"
                                                            BorderThickness="1"
                                                            VerticalAlignment="Center"
                                                            Visibility="{Binding ThumbnailImage, Converter={StaticResource NullToVisibilityConverter}}">
                                                        <Image Source="{Binding ThumbnailImage}"
                                                               Stretch="Uniform"
                                                               RenderOptions.BitmapScalingMode="HighQuality"/>
                                                    </Border>
                                                    <TextBlock Text="{Binding Name}" Margin="0,0,4,0" VerticalAlignment="Center">
                                                        <TextBlock.Style>
                                                            <Style TargetType="TextBlock">
                                                                <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding Parent}" Value="{x:Null}">
                                                                        <Setter Property="FontWeight" Value="Bold"/>
                                                                    </DataTrigger>
                                                                    <DataTrigger Binding="{Binding IsSelected}" Value="True">
                                                                        <Setter Property="Foreground" Value="#0A84FF"/>
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </TextBlock.Style>
                                                    </TextBlock>
                                                    <!-- Lock icon - shown when element is locked -->
                                                    <TextBlock Text="🔒" FontSize="10" Margin="0,0,4,0"
                                                               ToolTip="Element is locked (cannot select on canvas)">
                                                        <TextBlock.Style>
                                                            <Style TargetType="TextBlock">
                                                                <Setter Property="Visibility" Value="Collapsed"/>
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding IsLocked}" Value="True">
                                                                        <Setter Property="Visibility" Value="Visible"/>
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </TextBlock.Style>
                                                    </TextBlock>
                                                    <TextBlock Text="{Binding ElementType, StringFormat='[{0}]'}"
                                                               Foreground="{StaticResource TextSecondaryBrush}"
                                                               FontSize="10"
                                                               Margin="0,0,4,0"/>
                                                </StackPanel>
                                                <TextBlock Grid.Column="1"
                                                           Text="{Binding Children.Count, StringFormat='({0})'}"
                                                           Foreground="{StaticResource TextSecondaryBrush}"
                                                           FontSize="10"
                                                           Margin="4,0,0,0">
                                                    <TextBlock.Style>
                                                        <Style TargetType="TextBlock">
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding Children.Count}" Value="0">
                                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </TextBlock.Style>
                                                </TextBlock>
                                            </Grid>
                                        </Border>
                                    </HierarchicalDataTemplate>
                                </TreeView.ItemTemplate>
                                </TreeView>
                            </ScrollViewer>

                            <!-- Drop indicator overlay for hierarchy drag-drop -->
                            <Canvas x:Name="HierarchyDropIndicator" IsHitTestVisible="False" Visibility="Collapsed">
                                <!-- Line indicator for Before/After drop -->
                                <Rectangle x:Name="DropIndicatorLine"
                                           Width="200" Height="2"
                                           Fill="#0A84FF"
                                           RadiusX="1" RadiusY="1"
                                           Visibility="Collapsed"/>
                                <!-- Arrow indicator at start of line -->
                                <Polygon x:Name="DropIndicatorArrow"
                                         Points="0,0 8,4 0,8"
                                         Fill="#0A84FF"
                                         Visibility="Collapsed"/>
                            </Canvas>
                        </Grid>
                    </DockPanel>

                    <!-- Sidebar Vertical Splitter -->
                    <GridSplitter Grid.Row="1"
                                  HorizontalAlignment="Stretch"
                                  VerticalAlignment="Stretch"
                                  ResizeBehavior="PreviousAndNext"
                                  Cursor="SizeNS"/>

                    <!-- UI Components Section -->
                    <DockPanel Grid.Row="2" Margin="16">
                        <TextBlock DockPanel.Dock="Top"
                                   Text="UI COMPONENTS"
                                   FontSize="11"
                                   FontWeight="SemiBold"
                                   Foreground="{StaticResource TextSecondaryBrush}"
                                   Margin="0,0,0,12"/>

                        <ListBox x:Name="UILibraryListBox"
                                 Background="Transparent"
                                 BorderThickness="0"
                                 Foreground="{StaticResource TextPrimaryBrush}"
                                 SelectionMode="Single"
                                 HorizontalContentAlignment="Stretch"
                                 ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                                 ItemsSource="{Binding Source={StaticResource UILibraryGrouped}}">
                            <ListBox.ItemContainerStyle>
                                <Style TargetType="ListBoxItem" BasedOn="{StaticResource ModernListBoxItem}">
                                    <Setter Property="Padding" Value="12,8"/>
                                    <Setter Property="Margin" Value="0,0,0,4"/>
                                </Style>
                            </ListBox.ItemContainerStyle>
                            <ListBox.GroupStyle>
                                <GroupStyle>
                                    <GroupStyle.ContainerStyle>
                                        <Style TargetType="{x:Type GroupItem}">
                                            <Setter Property="Template">
                                                <Setter.Value>
                                                    <ControlTemplate TargetType="{x:Type GroupItem}">
                                                        <StackPanel Margin="0,8,0,4">
                                                            <!-- Category Header -->
                                                            <TextBlock Text="{Binding Name}"
                                                                       FontSize="11"
                                                                       FontWeight="Bold"
                                                                       Foreground="{StaticResource TextSecondaryBrush}"
                                                                       Margin="0,0,0,8"/>
                                                            <!-- Items -->
                                                            <ItemsPresenter/>
                                                        </StackPanel>
                                                    </ControlTemplate>
                                                </Setter.Value>
                                            </Setter>
                                        </Style>
                                    </GroupStyle.ContainerStyle>
                                </GroupStyle>
                            </ListBox.GroupStyle>
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>

                                        <!-- Color-coded icon based on category -->
                                        <Border Grid.Column="0"
                                                Width="18"
                                                Height="18"
                                                CornerRadius="3"
                                                Margin="0,0,8,0">
                                            <Border.Style>
                                                <Style TargetType="Border">
                                                    <Setter Property="Background" Value="#FF4A9EFF"/>
                                                    <Style.Triggers>
                                                        <!-- Containers = Blue -->
                                                        <DataTrigger Binding="{Binding Category}" Value="Containers">
                                                            <Setter Property="Background" Value="#FF4A9EFF"/>
                                                        </DataTrigger>
                                                        <!-- Controls = Green -->
                                                        <DataTrigger Binding="{Binding Category}" Value="Controls">
                                                            <Setter Property="Background" Value="#FF22C55E"/>
                                                        </DataTrigger>
                                                        <!-- Visual = Purple -->
                                                        <DataTrigger Binding="{Binding Category}" Value="Visual">
                                                            <Setter Property="Background" Value="#FFA855F7"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Border.Style>
                                            <Path Fill="White"
                                                  Width="10"
                                                  Height="10"
                                                  Stretch="Uniform"
                                                  HorizontalAlignment="Center"
                                                  VerticalAlignment="Center">
                                                <Path.Style>
                                                    <Style TargetType="Path">
                                                        <!-- Default: rectangle -->
                                                        <Setter Property="Data" Value="M0,0 H12 V12 H0 Z"/>
                                                        <Style.Triggers>
                                                            <!-- Canvas: dotted border -->
                                                            <DataTrigger Binding="{Binding Name}" Value="Canvas">
                                                                <Setter Property="Data" Value="M0,0 H12 V12 H0 Z M2,2 H10 V10 H2 Z"/>
                                                            </DataTrigger>
                                                            <!-- Grid: 2x2 grid -->
                                                            <DataTrigger Binding="{Binding Name}" Value="Grid">
                                                                <Setter Property="Data" Value="M0,0 H12 V12 H0 Z M6,0 V12 M0,6 H12"/>
                                                            </DataTrigger>
                                                            <!-- Stack Panel: stacked bars -->
                                                            <DataTrigger Binding="{Binding Name}" Value="Stack Panel">
                                                                <Setter Property="Data" Value="M0,0 H12 V3 H0 Z M0,4.5 H12 V7.5 H0 Z M0,9 H12 V12 H0 Z"/>
                                                            </DataTrigger>
                                                            <!-- Scroll Viewer: scroll arrows -->
                                                            <DataTrigger Binding="{Binding Name}" Value="Scroll Viewer">
                                                                <Setter Property="Data" Value="M0,0 H12 V12 H0 Z M10,3 V9 M10,3 L8,5 M10,3 L12,5"/>
                                                            </DataTrigger>
                                                            <!-- Uniform Grid: 3x3 grid -->
                                                            <DataTrigger Binding="{Binding Name}" Value="Uniform Grid">
                                                                <Setter Property="Data" Value="M0,0 H12 V12 H0 Z M4,0 V12 M8,0 V12 M0,4 H12 M0,8 H12"/>
                                                            </DataTrigger>
                                                            <!-- Button: rounded rect -->
                                                            <DataTrigger Binding="{Binding Name}" Value="Button">
                                                                <Setter Property="Data" Value="M2,0 H10 A2,2 0 0 1 12,2 V10 A2,2 0 0 1 10,12 H2 A2,2 0 0 1 0,10 V2 A2,2 0 0 1 2,0 Z"/>
                                                            </DataTrigger>
                                                            <!-- Edit Text: text input -->
                                                            <DataTrigger Binding="{Binding Name}" Value="Edit Text">
                                                                <Setter Property="Data" Value="M0,2 H12 V10 H0 Z M2,6 H8"/>
                                                            </DataTrigger>
                                                            <!-- Slider: slider track -->
                                                            <DataTrigger Binding="{Binding Name}" Value="Slider">
                                                                <Setter Property="Data" Value="M0,5 H12 V7 H0 Z M4,3 H6 V9 H4 Z"/>
                                                            </DataTrigger>
                                                            <!-- Image Element: picture frame -->
                                                            <DataTrigger Binding="{Binding Name}" Value="Image">
                                                                <Setter Property="Data" Value="M0,0 H12 V12 H0 Z M2,8 L4,6 L6,8 L8,5 L10,8"/>
                                                            </DataTrigger>
                                                            <!-- Content Control: box with dot -->
                                                            <DataTrigger Binding="{Binding Name}" Value="Content Control">
                                                                <Setter Property="Data" Value="M0,0 H12 V12 H0 Z M5,5 H7 V7 H5 Z"/>
                                                            </DataTrigger>
                                                            <!-- Modal: layered windows -->
                                                            <DataTrigger Binding="{Binding Name}" Value="Modal">
                                                                <Setter Property="Data" Value="M0,2 H10 V12 H0 Z M2,0 H12 V10"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </Path.Style>
                                            </Path>
                                        </Border>

                                        <TextBlock Grid.Column="1"
                                                   Text="{Binding Name}"
                                                   FontSize="13"
                                                   Foreground="{StaticResource TextPrimaryBrush}"
                                                   VerticalAlignment="Center"/>
                                    </Grid>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </DockPanel>
                </Grid>
            </Border>

            <!-- Left Splitter -->
            <GridSplitter Grid.Column="1"
                          HorizontalAlignment="Stretch"
                          VerticalAlignment="Stretch"
                          ResizeBehavior="PreviousAndNext"
                          Cursor="SizeWE"/>

            <!-- CENTER: Canvas Area + Content Browser -->
            <Grid Grid.Column="2" Background="{StaticResource CanvasBackgroundBrush}">
                <Grid.RowDefinitions>
                    <RowDefinition Height="*" MinHeight="300"/>
                    <RowDefinition Height="4"/>
                    <RowDefinition Height="200" MinHeight="150"/>
                </Grid.RowDefinitions>

                <!-- Canvas Area -->
                <DockPanel Grid.Row="0">
                    <!-- Canvas Toolbar -->
                    <Border DockPanel.Dock="Top"
                            Background="{StaticResource MediumBackgroundBrush}"
                            BorderBrush="{StaticResource BorderBrush}"
                            BorderThickness="0,0,0,1"
                            Height="48">
                        <Grid Margin="16,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <!-- Zoom Controls -->
                            <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                                <Button x:Name="ZoomInButton"
                                        Content="🔍+"
                                        Style="{StaticResource ModernButton}"
                                        Padding="8,4"
                                        FontSize="14"
                                        ToolTip="Zoom In"
                                        Margin="0,0,4,0"/>
                                <Button x:Name="ZoomOutButton"
                                        Content="🔍-"
                                        Style="{StaticResource ModernButton}"
                                        Padding="8,4"
                                        FontSize="14"
                                        ToolTip="Zoom Out"
                                        Margin="0,0,4,0"/>
                                <Button x:Name="ResetZoomButton"
                                        Content="100%"
                                        Style="{StaticResource ModernButton}"
                                        Padding="8,4"
                                        FontSize="12"
                                        ToolTip="Reset Zoom"
                                        Margin="0,0,12,0"/>

                                <Border Background="{StaticResource InputBackgroundBrush}"
                                        BorderBrush="{StaticResource BorderBrush}"
                                        BorderThickness="1"
                                        CornerRadius="4"
                                        Padding="8,4"
                                        Margin="0,0,4,0">
                                    <TextBlock x:Name="ZoomLevelText"
                                               Text="100%"
                                               FontSize="12"
                                               Foreground="{StaticResource TextPrimaryBrush}"
                                               MinWidth="50"
                                               TextAlignment="Center"/>
                                </Border>
                            </StackPanel>

                            <!-- Snap and Grid Controls -->
                            <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                                <TextBlock Text="Snap:"
                                           FontSize="12"
                                           Foreground="{StaticResource TextSecondaryBrush}"
                                           VerticalAlignment="Center"
                                           Margin="0,0,8,0"/>
                                <TextBox x:Name="SnapValueTextBox"
                                         Text="10"
                                         Style="{StaticResource ModernTextBox}"
                                         Width="50"
                                         Padding="6,4"
                                         FontSize="12"
                                         ToolTip="Snap grid size"
                                         Margin="0,0,12,0"/>

                                <!-- Separator -->
                                <Border Width="1" Height="20" Background="{StaticResource BorderBrush}" Margin="0,0,12,0"/>

                                <!-- Alignment Tools -->
                                <TextBlock Text="Align:"
                                           FontSize="12"
                                           Foreground="{StaticResource TextSecondaryBrush}"
                                           VerticalAlignment="Center"
                                           Margin="0,0,6,0"/>
                                <Button x:Name="AlignLeftButton" Click="AlignLeft_Click"
                                        Style="{StaticResource ModernButton}" Padding="4" ToolTip="Align Left" Margin="0,0,2,0">
                                    <Path Data="M0,0 V12 M0,2 H10 M0,6 H7 M0,10 H10" Stroke="{StaticResource TextPrimaryBrush}" StrokeThickness="1.5" Width="12" Height="12"/>
                                </Button>
                                <Button x:Name="AlignCenterHButton" Click="AlignCenterH_Click"
                                        Style="{StaticResource ModernButton}" Padding="4" ToolTip="Align Center (Horizontal)" Margin="0,0,2,0">
                                    <Path Data="M6,0 V12 M2,2 H10 M3,6 H9 M2,10 H10" Stroke="{StaticResource TextPrimaryBrush}" StrokeThickness="1.5" Width="12" Height="12"/>
                                </Button>
                                <Button x:Name="AlignRightButton" Click="AlignRight_Click"
                                        Style="{StaticResource ModernButton}" Padding="4" ToolTip="Align Right" Margin="0,0,6,0">
                                    <Path Data="M12,0 V12 M2,2 H12 M5,6 H12 M2,10 H12" Stroke="{StaticResource TextPrimaryBrush}" StrokeThickness="1.5" Width="12" Height="12"/>
                                </Button>
                                <Button x:Name="AlignTopButton" Click="AlignTop_Click"
                                        Style="{StaticResource ModernButton}" Padding="4" ToolTip="Align Top" Margin="0,0,2,0">
                                    <Path Data="M0,0 H12 M2,0 V10 M6,0 V7 M10,0 V10" Stroke="{StaticResource TextPrimaryBrush}" StrokeThickness="1.5" Width="12" Height="12"/>
                                </Button>
                                <Button x:Name="AlignCenterVButton" Click="AlignCenterV_Click"
                                        Style="{StaticResource ModernButton}" Padding="4" ToolTip="Align Center (Vertical)" Margin="0,0,2,0">
                                    <Path Data="M0,6 H12 M2,2 V10 M6,3 V9 M10,2 V10" Stroke="{StaticResource TextPrimaryBrush}" StrokeThickness="1.5" Width="12" Height="12"/>
                                </Button>
                                <Button x:Name="AlignBottomButton" Click="AlignBottom_Click"
                                        Style="{StaticResource ModernButton}" Padding="4" ToolTip="Align Bottom" Margin="0,0,12,0">
                                    <Path Data="M0,12 H12 M2,2 V12 M6,5 V12 M10,2 V12" Stroke="{StaticResource TextPrimaryBrush}" StrokeThickness="1.5" Width="12" Height="12"/>
                                </Button>

                                <!-- Distribute Tools -->
                                <Button x:Name="DistributeHButton" Click="DistributeH_Click"
                                        Style="{StaticResource ModernButton}" Padding="4" ToolTip="Distribute Horizontally" Margin="0,0,2,0">
                                    <Path Data="M0,0 V12 M6,2 V10 M12,0 V12" Stroke="{StaticResource TextPrimaryBrush}" StrokeThickness="1.5" Width="12" Height="12"/>
                                </Button>
                                <Button x:Name="DistributeVButton" Click="DistributeV_Click"
                                        Style="{StaticResource ModernButton}" Padding="4" ToolTip="Distribute Vertically" Margin="0,0,12,0">
                                    <Path Data="M0,0 H12 M2,6 H10 M0,12 H12" Stroke="{StaticResource TextPrimaryBrush}" StrokeThickness="1.5" Width="12" Height="12"/>
                                </Button>

                                <!-- Separator -->
                                <Border Width="1" Height="20" Background="{StaticResource BorderBrush}" Margin="0,0,12,0"/>

                                <Button x:Name="SettingsButton"
                                        Content="⚙"
                                        Style="{StaticResource ModernButton}"
                                        Padding="8,4"
                                        FontSize="14"
                                        ToolTip="Settings"
                                        Margin="0,0,4,0"/>

                                <Button x:Name="CenterViewButton"
                                        Style="{StaticResource ModernButton}"
                                        Padding="8,4"
                                        ToolTip="Center View">
                                    <Path Data="M0,0 H12 V12 H0 Z M3,3 H9 V9 H3 Z"
                                          Stroke="{StaticResource TextPrimaryBrush}"
                                          StrokeThickness="1.5"
                                          Width="12"
                                          Height="12"
                                          Stretch="Uniform"/>
                                </Button>
                            </StackPanel>
                        </Grid>
                    </Border>

                    <!-- Canvas Viewport with Grid Background -->
                    <Border Margin="0">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="20"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="20"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <!-- Corner square -->
                            <Border Grid.Row="0" Grid.Column="0" Background="#1E1E1E"/>

                            <!-- Horizontal Ruler -->
                            <controls:Ruler Grid.Row="0" Grid.Column="1"
                                           x:Name="HorizontalRuler"
                                           Orientation="Horizontal"/>

                            <!-- Vertical Ruler -->
                            <controls:Ruler Grid.Row="1" Grid.Column="0"
                                           x:Name="VerticalRuler"
                                           Orientation="Vertical"/>

                            <!-- Canvas area -->
                            <Grid Grid.Row="1" Grid.Column="1" ClipToBounds="True">
                                <!-- Visible grid background pattern -->
                                <Rectangle x:Name="GridBackground">
                                <Rectangle.Fill>
                                    <DrawingBrush x:Name="GridBrush" Viewport="0,0,10,10" ViewportUnits="Absolute" TileMode="Tile">
                                        <DrawingBrush.Drawing>
                                            <DrawingGroup>
                                                <!-- Base background -->
                                                <GeometryDrawing Brush="{StaticResource CanvasBackgroundBrush}">
                                                    <GeometryDrawing.Geometry>
                                                        <RectangleGeometry Rect="0,0,10,10"/>
                                                    </GeometryDrawing.Geometry>
                                                </GeometryDrawing>
                                                <!-- Horizontal grid line -->
                                                <GeometryDrawing>
                                                    <GeometryDrawing.Geometry>
                                                        <LineGeometry StartPoint="0,0" EndPoint="10,0"/>
                                                    </GeometryDrawing.Geometry>
                                                    <GeometryDrawing.Pen>
                                                        <Pen Brush="#0AFFFFFF" Thickness="1"/>
                                                    </GeometryDrawing.Pen>
                                                </GeometryDrawing>
                                                <!-- Vertical grid line -->
                                                <GeometryDrawing>
                                                    <GeometryDrawing.Geometry>
                                                        <LineGeometry StartPoint="0,0" EndPoint="0,10"/>
                                                    </GeometryDrawing.Geometry>
                                                    <GeometryDrawing.Pen>
                                                        <Pen Brush="#0AFFFFFF" Thickness="1"/>
                                                    </GeometryDrawing.Pen>
                                                </GeometryDrawing>
                                            </DrawingGroup>
                                        </DrawingBrush.Drawing>
                                    </DrawingBrush>
                                </Rectangle.Fill>
                            </Rectangle>

                            <ScrollViewer HorizontalScrollBarVisibility="Auto"
                                          VerticalScrollBarVisibility="Auto"
                                          x:Name="CanvasScrollViewer"
                                          Background="Transparent">
                                <Canvas x:Name="EditorCanvas"
                                        Background="Transparent"
                                        RenderTransformOrigin="0.5,0.5"
                                        MouseLeftButtonDown="EditorCanvas_MouseLeftButtonDown">
                                    <Canvas.RenderTransform>
                                        <ScaleTransform x:Name="CanvasScaleTransform" ScaleX="1.0" ScaleY="1.0"/>
                                    </Canvas.RenderTransform>

                                    <!-- Artboard Size Label -->
                                    <TextBlock x:Name="ArtboardSizeLabel"
                                               Text="1280 × 720"
                                               FontSize="18"
                                               Foreground="#FF888888"
                                               Canvas.Left="0"
                                               Canvas.Top="-30"/>

                                    <!-- Root Container (Artboard) -->
                                    <Border x:Name="RootArtboard"
                                            Width="1280"
                                            Height="720"
                                            Background="#FF2A2A2A"
                                            BorderBrush="#FF3A3A3A"
                                            BorderThickness="2"
                                            CornerRadius="4">
                                        <Grid>
                                            <!-- Reference Image (background layer for alignment) -->
                                            <Image x:Name="ReferenceImage"
                                                   Stretch="Fill"
                                                   Opacity="0.3"
                                                   Visibility="Collapsed"
                                                   IsHitTestVisible="False"/>

                                            <!-- Artboard Canvas - THIS is where elements live -->
                                            <Canvas x:Name="ArtboardCanvas"
                                                    Background="Transparent"/>

                                            <!-- Selection Box Overlay (marquee selection rectangle) -->
                                            <Canvas x:Name="SelectionBoxCanvas" IsHitTestVisible="False">
                                                <Rectangle x:Name="SelectionBox"
                                                           Stroke="#FF0A84FF"
                                                           StrokeThickness="1"
                                                           StrokeDashArray="4 2"
                                                           Fill="#200A84FF"
                                                           Visibility="Collapsed"/>
                                            </Canvas>

                                            <!-- Spacing Guide Overlay (shows distance lines during drag) -->
                                            <controls:SpacingGuideOverlay x:Name="SpacingGuideOverlay"
                                                                          IsHitTestVisible="False"/>

                                            <!-- Empty state text (shown when no elements) -->
                                            <TextBlock x:Name="EmptyStateText"
                                                       Text="Drag UI elements from the library to start"
                                                       HorizontalAlignment="Center"
                                                       VerticalAlignment="Center"
                                                       FontSize="16"
                                                       Foreground="#FF666666"
                                                       FontStyle="Italic"
                                                       IsHitTestVisible="False"/>
                                        </Grid>
                                    </Border>
                                </Canvas>
                            </ScrollViewer>

                            <!-- Guides overlay -->
                            <Canvas x:Name="GuidesCanvas"/>
                            </Grid>
                        </Grid>
                    </Border>
                </DockPanel>

                <!-- Vertical Splitter -->
                <GridSplitter Grid.Row="1"
                              HorizontalAlignment="Stretch"
                              VerticalAlignment="Stretch"
                              ResizeBehavior="PreviousAndNext"
                              Cursor="SizeNS"/>

                <!-- Content Browser -->
                <Border Grid.Row="2"
                        Background="{StaticResource MediumBackgroundBrush}"
                        BorderBrush="{StaticResource BorderBrush}"
                        BorderThickness="0,1,0,0">
                    <DockPanel>
                        <!-- Content Browser Header -->
                        <Border DockPanel.Dock="Top"
                                BorderBrush="{StaticResource BorderBrush}"
                                BorderThickness="0,0,0,1"
                                Height="40">
                            <Grid Margin="16,0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <TextBlock Grid.Column="0"
                                           Text="Content Browser"
                                           FontSize="13"
                                           FontWeight="SemiBold"
                                           Foreground="{StaticResource TextPrimaryBrush}"
                                           VerticalAlignment="Center"/>

                                <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                                    <!-- Folder Filter Button -->
                                    <Button x:Name="FolderFilterButton"
                                            Style="{StaticResource ModernButton}"
                                            Padding="8,4"
                                            ToolTip="Filter by folder"
                                            Click="FolderFilterButton_Click"
                                            Margin="0,0,4,0">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="📁" FontSize="12" VerticalAlignment="Center"/>
                                            <TextBlock x:Name="FolderFilterLabel"
                                                       Text="All"
                                                       FontSize="11"
                                                       Foreground="{StaticResource TextSecondaryBrush}"
                                                       VerticalAlignment="Center"
                                                       Margin="4,0,0,0"
                                                       MaxWidth="80"
                                                       TextTrimming="CharacterEllipsis"/>
                                        </StackPanel>
                                    </Button>
                                    <!-- Clear folder filter -->
                                    <Button x:Name="ClearFolderFilterButton"
                                            Style="{StaticResource ModernButton}"
                                            Padding="4"
                                            ToolTip="Clear folder filter"
                                            Click="ClearFolderFilterButton_Click"
                                            Visibility="Collapsed"
                                            Margin="0,0,8,0">
                                        <TextBlock Text="✕" FontSize="10" Foreground="{StaticResource TextSecondaryBrush}"/>
                                    </Button>
                                    <TextBox x:Name="AssetSearchBox"
                                             Width="200"
                                             Style="{StaticResource ModernTextBox}"
                                             Padding="8,4"
                                             FontSize="12"
                                             Text="Search assets..."
                                             Foreground="{StaticResource TextSecondaryBrush}"
                                             GotFocus="AssetSearchBox_GotFocus"
                                             LostFocus="AssetSearchBox_LostFocus"
                                             TextChanged="AssetSearchBox_TextChanged"
                                             Margin="0,0,8,0"/>

                                </StackPanel>
                            </Grid>
                        </Border>

                        <!-- Content Browser Body -->
                        <Grid Margin="16">
                            <!-- Empty State -->
                            <StackPanel x:Name="EmptyStatePanel"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center">
                                <TextBlock x:Name="EmptyStateIcon"
                                           Text="📁"
                                           FontSize="48"
                                           HorizontalAlignment="Center"
                                           Margin="0,0,0,8"/>
                                <TextBlock x:Name="EmptyStateTitle"
                                           Text="No project connected"
                                           FontSize="14"
                                           FontWeight="SemiBold"
                                           Foreground="{StaticResource TextPrimaryBrush}"
                                           HorizontalAlignment="Center"
                                           Margin="0,0,0,4"/>
                                <TextBlock x:Name="EmptyStateSubtitle"
                                           Text="Connect to a Stride project to view assets"
                                           Foreground="{StaticResource TextSecondaryBrush}"
                                           FontSize="12"
                                           HorizontalAlignment="Center"/>
                            </StackPanel>

                            <!-- Asset Grid -->
                            <!-- Removed redundant ScrollViewer to fix mouse wheel scrolling -->
                            <ListView x:Name="ProjectContentListView"
                                      Visibility="Collapsed"
                                      Background="Transparent"
                                      BorderThickness="0"
                                      ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                                      ScrollViewer.VerticalScrollBarVisibility="Auto">
                                <ListView.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <WrapPanel/>
                                    </ItemsPanelTemplate>
                                </ListView.ItemsPanel>
                                    <ListView.ItemContainerStyle>
                                        <Style TargetType="ListViewItem">
                                            <Setter Property="Background" Value="Transparent"/>
                                            <Setter Property="Padding" Value="12"/>
                                            <Setter Property="Template">
                                                <Setter.Value>
                                                    <ControlTemplate TargetType="ListViewItem">
                                                        <Border x:Name="Border"
                                                                Background="{TemplateBinding Background}"
                                                                CornerRadius="8"
                                                                Padding="{TemplateBinding Padding}">
                                                            <ContentPresenter/>
                                                        </Border>
                                                        <ControlTemplate.Triggers>
                                                            <Trigger Property="IsMouseOver" Value="True">
                                                                <Setter TargetName="Border" Property="Background" Value="{StaticResource HoverBrush}"/>
                                                            </Trigger>
                                                        </ControlTemplate.Triggers>
                                                    </ControlTemplate>
                                                </Setter.Value>
                                            </Setter>
                                        </Style>
                                    </ListView.ItemContainerStyle>
                                <ListView.ItemTemplate>
                                    <DataTemplate>
                                        <StackPanel Width="100">
                                            <Border Width="60" Height="60"
                                                    Background="{StaticResource InputBackgroundBrush}"
                                                    BorderBrush="{StaticResource BorderBrush}"
                                                    BorderThickness="1"
                                                    CornerRadius="6"
                                                    HorizontalAlignment="Center"
                                                    Margin="0,0,0,8">
                                                <Grid>
                                                    <!-- Image preview (visible if Thumbnail is loaded) -->
                                                    <Image Source="{Binding Thumbnail}"
                                                           Stretch="Uniform"
                                                           Margin="2">
                                                        <Image.Style>
                                                            <Style TargetType="Image">
                                                                <Setter Property="Visibility" Value="Visible"/>
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding Thumbnail}" Value="{x:Null}">
                                                                        <Setter Property="Visibility" Value="Collapsed"/>
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </Image.Style>
                                                    </Image>
                                                    <!-- Fallback icon (visible if no Thumbnail) -->
                                                    <TextBlock Text="{Binding Icon}"
                                                               FontSize="28"
                                                               HorizontalAlignment="Center"
                                                               VerticalAlignment="Center">
                                                        <TextBlock.Style>
                                                            <Style TargetType="TextBlock">
                                                                <Setter Property="Visibility" Value="Collapsed"/>
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding Thumbnail}" Value="{x:Null}">
                                                                        <Setter Property="Visibility" Value="Visible"/>
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </TextBlock.Style>
                                                    </TextBlock>
                                                </Grid>
                                            </Border>
                                            <TextBlock Text="{Binding Name}"
                                                       TextTrimming="CharacterEllipsis"
                                                       TextAlignment="Center"
                                                       FontSize="12"
                                                       Foreground="{StaticResource TextPrimaryBrush}"
                                                       Margin="0,0,0,2"/>
                                            <TextBlock Text="{Binding Type}"
                                                       TextAlignment="Center"
                                                       FontSize="10"
                                                       Foreground="{StaticResource TextSecondaryBrush}"/>
                                        </StackPanel>
                                    </DataTemplate>
                                </ListView.ItemTemplate>
                            </ListView>
                        </Grid>
                    </DockPanel>
                </Border>
            </Grid>

            <!-- Right Splitter -->
            <GridSplitter Grid.Column="3"
                          HorizontalAlignment="Stretch"
                          VerticalAlignment="Stretch"
                          ResizeBehavior="PreviousAndNext"
                          Cursor="SizeWE"/>

            <!-- RIGHT SIDEBAR: Properties -->
            <Border Grid.Column="4"
                    Background="{StaticResource MediumBackgroundBrush}"
                    BorderBrush="{StaticResource BorderBrush}"
                    BorderThickness="1,0,0,0">
                <DockPanel Margin="12,12,8,12">
                    <StackPanel DockPanel.Dock="Top" Margin="0,0,0,16">
                        <TextBlock Text="Properties"
                                   FontSize="18"
                                   FontWeight="SemiBold"
                                   Foreground="{StaticResource TextPrimaryBrush}"
                                   Margin="0,0,0,4"/>
                    </StackPanel>

                    <views:PropertyPanel x:Name="PropertiesPanel"/>
                </DockPanel>
            </Border>
        </Grid>

        </DockPanel>

        <!-- Loading Overlay -->
        <Grid x:Name="LoadingOverlay"
              Background="#CC1A1A1A"
              Visibility="Collapsed"
              Panel.ZIndex="1000">
            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                <ProgressBar x:Name="LoadingProgress"
                             IsIndeterminate="True"
                             Width="200"
                             Height="4"
                             Foreground="#0A84FF"
                             Background="#3A3A3A"
                             BorderThickness="0"/>
                <TextBlock x:Name="LoadingText"
                           Text="Loading..."
                           Foreground="{StaticResource TextPrimaryBrush}"
                           FontSize="14"
                           HorizontalAlignment="Center"
                           Margin="0,16,0,0"/>
            </StackPanel>
        </Grid>
    </Grid>
</Window>
